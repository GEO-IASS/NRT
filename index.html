<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Near-real time deforestation monitoring  by bullocke</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.18.0/mapbox-gl.js'></script>
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.18.0/mapbox-gl.css' rel='stylesheet' />
        <style>
              body { margin:0; padding:0; }
                #map { position:absolute; top:0; bottom:0; width:100%; }
            </style>
  </head>
  <body>
<style>
    #menu {
        background: #fff;
        position: absolute;
        z-index: 1;
        top: 10px;
        right: 30px;
        border-radius: 3px;
        width: 120px;
        border: 1px solid rgba(0,0,0,0.4);
        font-family: 'Open Sans', sans-serif;
    }

    #menu a {
        font-size: 13px;
        color: #404040;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        text-decoration: none;
        border-bottom: 1px solid rgba(0,0,0,0.25);
        text-align: center;
    }

    #menu a:last-child {
        border: none;
    }

    #menu a:hover {
        background-color: #f8f8f8;
        color: #404040;
    }

    #menu a.active {
        background-color: #3887be;
        color: #ffffff;
    }

    #menu a.active:hover {
        background: #3074a4;
    }
</style>
    <div class="wrapper">
      <header>
        <h1 class="header">Near-real time deforestation monitoring </h1>
        <p class="header">Operational example of near-real time change detection using daily MODIS products.</p>

        <ul>
          <li><a class="buttons github" href="https://github.com/bullocke/NRT">View On GitHub</a></li>
        </ul>

        <p class="header">This project is maintained by <a class="header name" href="https://github.com/bullocke">bullocke</a></p>


      </header>
      <section>
        <h3>
        <nav id="menu"></nav>
        <div id='map' class='dark'></div>



<script>
mapboxgl.accessToken = 'pk.eyJ1IjoiYnVsbG9ja2UiLCJhIjoiQ1dNTFJiVSJ9.-6m5HWxlG6pixRS8mRdb9g';
//mapboxgl.accessToken = 'sk.eyJ1IjoiYnVsbG9ja2UiLCJhIjoiY2lwMDVuaGwxMDJlZXVvbThnbzU0YXl4byJ9.InJ9GwQ4gTyt7BVHqGmmcA'
var boundary = {
"type": "FeatureCollection",
"crs": { "type": "name", "properties": { "name": "urn:ogc:def:crs:OGC:1.3:CRS84" } },
                                                                                
"features": [
{ "type": "Feature", "properties": { "location": "2012_Class.tif" }, "geometry": { "type": "Polygon", "coordinates": [ [ [ -59.999999994611805, 0.0 ], [ -49.999999995479868, 0.0 ], [ -50.771330589561749, -9.999999999131946 ], [ -60.925596707510628, -9.999999999131946 ], [ -59.999999994611805, 0.0 ] ] ] } }
]
}

var map = new mapboxgl.Map({
    container: 'map', 
    style: 'mapbox://styles/mapbox/satellite-v9',
    center: [-55.0, -7.5],
    zoom: 7
});


map.on('load', function () {
    map.addSource('2012_ClassPoly', {
        type: 'vector',
        url: 'mapbox://bullocke.15oowcct'
    });
    map.addLayer({
        "id": "2012_ClassPoly",
        "type": "fill",
        "source": "2012_ClassPoly",
        "source-layer": "2012_ClassPoly",
        "paint": {
            "fill-color": "#ffffb2",
        },
        "layout": {
            "visibility": "visible",
        }
    });

    map.addSource("boundary", {
        "type": "geojson",
        "data": boundary
    });

    // Add a layer showing the markers.
    map.addLayer({
        "id": "boundary",
        "type": "line",
        "source": "boundary",
        "paint": {
            "line-color": "#46c6c6",
            "line-width": 2
        }
    });

    map.addSource('2013_ClassPoly', {
        type: 'vector',
        url: 'mapbox://bullocke.dpg5u0go'
    });
    map.addLayer({
        "id": "2013_ClassPoly",
        "type": "fill",
        "source": "2013_ClassPoly",
        "source-layer": "2013_ClassPoly",
        "paint": {
            "fill-color": "#fecc5c",
        },
        "layout": {
            "visibility": "visible",
        }
    });
    map.addSource('2014_ClassPoly', {
        type: 'vector',
        url: 'mapbox://bullocke.c9lq27dt'
    });
    map.addLayer({
        "id": "2014_ClassPoly",
        "type": "fill",
        "source": "2014_ClassPoly",
        "source-layer": "2014_ClassPoly",
        "paint": {
            "fill-color": "#fd8d3c",
        },
        "layout": {
            "visibility": "visible",
        }
    });
    map.addSource('2015_ClassPoly', {
        type: 'vector',
        url: 'mapbox://bullocke.a91p6kxj'
    });
    map.addLayer({
        "id": "2015_ClassPoly",
        "type": "fill",
        "source": "2015_ClassPoly",
        "source-layer": "2015_ClassPoly",
        "paint": {
            "fill-color": "#e31a1c",
        },
        "layout": {
            "visibility": "visible",
        }
    });
    map.addSource('confirmedchanges', {
        type: 'vector',
        url: 'mapbox://bullocke.Confirmed'
    });
    map.addLayer({
        "id": "confirmedchanges",
        "type": "fill",
        "source": "confirmedchanges",
        "source-layer": "confirmedchanges",
        "paint": {
            "fill-color": "#860106",
        },
        "layout": {
            "visibility": "visible",
        }
    });
    map.addSource('lowprob', {
        type: 'vector',
        url: 'mapbox://bullocke.LowProb'
    });
    map.addLayer({
        "id": "lowprob",
        "type": "fill",
        "source": "lowprob",
        "source-layer": "lowprob",
        "paint": {
            "fill-color": "#6CFF00",
        },
        "layout": {
            "visibility": "visible",
        }
    });
    map.addSource('highprob', {
        type: 'vector',
        url: 'mapbox://bullocke.HighProb'
    });
    map.addLayer({
        "id": "highprob",
        "type": "fill",
        "source": "highprob",
        "source-layer": "highprob",
        "paint": {
            "fill-color": "#0000FF",
        },
        "layout": {
            "visibility": "visible",
        }
    });
});

//Do popups for each year, this needs to be condensed. 
var popuphighprob = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
 });

 map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['highprob'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popuplowprob.remove();
      return;
    }
    
    var feature = features[0];

    popuphighprob.setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.Date)
        .addTo(map);
});

var popuplowprob = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
 });

 map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['lowprob'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popuplowprob.remove();
      return;
    }
    
    var feature = features[0];

    popuplowprob.setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.Date)
        .addTo(map);
});

var popup2016 = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
 });

 map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['confirmedchanges'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popup2016.remove();
      return;
    }
    
    var feature = features[0];

    popup2016.setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.Date)
        .addTo(map);
});
var popup2015 = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
 });

 map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['2015_ClassPoly'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popup2015.remove();
      return;
    }
    
    var feature = features[0];

    popup2015.setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.DN)
        .addTo(map);
});

var popup2014 = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
 });

 map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['2014_ClassPoly'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popup2014.remove();
      return;
    }
    
    var feature = features[0];

    popup2014.setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.DN)
        .addTo(map);
});

var popup2013 = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
 });

 map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['2013_ClassPoly'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popup2013.remove();
      return;
    }
    
    var feature = features[0];

    popup2013.setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.DN)
        .addTo(map);
});

var popup2012 = new mapboxgl.Popup({
      closeButton: false,
      closeOnClick: false
 });

 map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['2012_ClassPoly'] });
      map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';

    if (!features.length) {
      popup2012.remove();
      return;
    }
    
    var feature = features[0];

    popup2012.setLngLat(map.unproject(e.point))
        .setHTML(feature.properties.DN)
        .addTo(map);
});

addLayer('Low Probability', 'lowprob');
addLayer('High Probability', 'highprob');
addLayer('2016', 'confirmedchanges');
addLayer('2015', '2015_ClassPoly');
addLayer('2014', '2014_ClassPoly');
addLayer('2013', '2013_ClassPoly');
addLayer('2012', '2012_ClassPoly');

function addLayer(name, id) {
    var link = document.createElement('a');
    link.href = '#';
    link.className = 'active';
    link.textContent = name;

    link.onclick = function (e) {
        e.preventDefault();
        e.stopPropagation();

        var visibility = map.getLayoutProperty(id, 'visibility');

        if (visibility === 'visible') {
            map.setLayoutProperty(id, 'visibility', 'none');
            this.className = '';
        } else {
            this.className = 'active';
            map.setLayoutProperty(id, 'visibility', 'visible');
        }
    };

    var layers = document.getElementById('menu');
    layers.appendChild(link);
}
</script>
<h3>
<a id="support-or-contact" class="anchor" href="#support-or-contact" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Support or Contact</h3>

      </section>
      <footer>
        <img src="images/legend.jpg", width="240"> 
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
        
  </body>
</html>
